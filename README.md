# æœŸè´§ä¿è¯é‡‘æ³¢åŠ¨ç‡åŠ¨æ€ç ”ç©¶é¡¹ç›®

æœ¬é¡¹ç›®ç ”ç©¶æœŸè´§å¸‚åœºä¿è¯é‡‘è°ƒæ•´å¯¹å¸‚åœºæ³¢åŠ¨ç‡å’Œä»·æ ¼åŠ¨æ€çš„å½±å“ï¼Œé‡‡ç”¨å±€éƒ¨æŠ•å½±è„‰å†²å“åº”å‡½æ•°(LP-IRF)å’Œäº‹ä»¶ç ”ç©¶æ–¹æ³•è¿›è¡Œåˆ†æã€‚

## ğŸ†• æ–°å¢åŠŸèƒ½ï¼šäº‹ä»¶ç ”ç©¶æ–¹æ³•

æœ¬é¡¹ç›®ç°å·²å®ç°å®Œæ•´çš„äº‹ä»¶ç ”ç©¶æ–¹æ³•æ¡†æ¶ï¼Œä½œä¸ºLP-IRFåˆ†æçš„é‡è¦è¡¥å……ï¼š

### ä¸»è¦ç‰¹æ€§
- **å®Œæ•´çš„äº‹ä»¶ç ”ç©¶æµç¨‹**ï¼šäº‹ä»¶è¯†åˆ«ã€æ­£å¸¸æ”¶ç›Šç‡ä¼°è®¡ã€å¼‚å¸¸æ”¶ç›Šç‡è®¡ç®—ã€ç»Ÿè®¡æ£€éªŒ
- **å¤šç§æ­£å¸¸æ”¶ç›Šç‡æ¨¡å‹**ï¼šå¸‚åœºæ¨¡å‹ã€å‡å€¼è°ƒæ•´æ¨¡å‹ã€å¸‚åœºè°ƒæ•´æ¨¡å‹
- **ç¨³å¥æ€§æ£€éªŒ**ï¼šæ›¿ä»£æ³¢åŠ¨ç‡æŒ‡æ ‡ã€ä¸åŒé˜ˆå€¼ã€æ’é™¤æç«¯äº‹ä»¶ã€å“ç§åˆ†ç»„åˆ†æ
- **æ¯”è¾ƒåˆ†æ**ï¼šLP-IRFä¸äº‹ä»¶ç ”ç©¶ç»“æœçš„ç³»ç»Ÿæ€§æ¯”è¾ƒ
- **ä¸°å¯Œçš„å¯è§†åŒ–**ï¼šAAR/CAARæ—¶é—´åºåˆ—å›¾ã€äº‹ä»¶åˆ†å¸ƒå›¾ã€æ¯”è¾ƒåˆ†æå›¾

### æ ¸å¿ƒä¼˜åŠ¿
- **äº’è¡¥éªŒè¯**ï¼šä¸¤ç§æ–¹æ³•çš„ä¸€è‡´æ€§ç»“æœå¢å¼ºç ”ç©¶ç»“è®ºå¯ä¿¡åº¦
- **æ—¶é—´ç»´åº¦**ï¼šäº‹ä»¶ç ”ç©¶å…³æ³¨çŸ­æœŸå½±å“(Â±10å¤©)ï¼ŒLP-IRFå…³æ³¨ä¸­æœŸå½±å“(0-10æœŸ)
- **æ–¹æ³•è®ºå¤šæ ·æ€§**ï¼šä¸åŒçš„è¯†åˆ«ç­–ç•¥å’Œç»Ÿè®¡æ¡†æ¶æä¾›æ›´å…¨é¢çš„åˆ†æè§†è§’

## é¡¹ç›®ç»“æ„

```
futures_margin_volatility_dynamics/
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ raw/                    # åŸå§‹æ•°æ®
â”‚   â””â”€â”€ processed/              # å¤„ç†åçš„æ•°æ®
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ analysis/               # åˆ†ææ¨¡å—
â”‚   â”‚   â”œâ”€â”€ lp_irf_analysis.py         # LP-IRFåˆ†æ
â”‚   â”‚   â”œâ”€â”€ event_study_analysis.py    # äº‹ä»¶ç ”ç©¶åˆ†æ ğŸ†•
â”‚   â”‚   â”œâ”€â”€ comparative_analysis.py    # æ¯”è¾ƒåˆ†æ ğŸ†•
â”‚   â”‚   â””â”€â”€ run_event_study.py         # äº‹ä»¶ç ”ç©¶ä¸»æ‰§è¡Œè„šæœ¬ ğŸ†•
â”‚   â”œâ”€â”€ data_processing/        # æ•°æ®å¤„ç†
â”‚   â”œâ”€â”€ robustness/            # ç¨³å¥æ€§æ£€éªŒ
â”‚   â”œâ”€â”€ utils/                 # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ visualization/         # å¯è§†åŒ–
â”‚       â”œâ”€â”€ plot_lp_irf_results.py     # LP-IRFç»“æœå¯è§†åŒ–
â”‚       â””â”€â”€ plot_event_study_results.py # äº‹ä»¶ç ”ç©¶ç»“æœå¯è§†åŒ– ğŸ†•
â”œâ”€â”€ output/
â”‚   â”œâ”€â”€ tables/                # ç»“æœè¡¨æ ¼
â”‚   â”œâ”€â”€ figures/               # å›¾è¡¨
â”‚   â””â”€â”€ logs/                  # æ—¥å¿—æ–‡ä»¶
â”œâ”€â”€ docs/
â”‚   â””â”€â”€ event_study_methodology.md     # äº‹ä»¶ç ”ç©¶æ–¹æ³•æ–‡æ¡£ ğŸ†•
â””â”€â”€ test_event_study.py        # äº‹ä»¶ç ”ç©¶æµ‹è¯•è„šæœ¬ ğŸ†•
```

## å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒé…ç½®

ç¡®ä¿å·²å®‰è£…æ‰€éœ€ä¾èµ–ï¼š
```bash
pip install -r requirements.txt
```

### 2. æ•°æ®å‡†å¤‡

å°†åŸå§‹æ•°æ®æ–‡ä»¶æ”¾ç½®åœ¨ `data/raw/` ç›®å½•ä¸‹ï¼Œç„¶åè¿è¡Œæ•°æ®å¤„ç†ï¼š
```bash
python src/data_processing/build_features.py
```

### 3. è¿è¡Œåˆ†æ

#### é€‰é¡¹Aï¼šè¿è¡Œå®Œæ•´çš„äº‹ä»¶ç ”ç©¶åˆ†æ ğŸ†•
```bash
python src/analysis/run_event_study.py
```

è¿™å°†æ‰§è¡Œï¼š
- ä¸»è¦äº‹ä»¶ç ”ç©¶åˆ†æ
- ç¨³å¥æ€§æ£€éªŒï¼ˆæ›¿ä»£æŒ‡æ ‡ã€ä¸åŒé˜ˆå€¼ã€æ’é™¤æç«¯äº‹ä»¶ã€å“ç§åˆ†ç»„ï¼‰
- ä¸LP-IRFç»“æœçš„æ¯”è¾ƒåˆ†æ
- è‡ªåŠ¨ç”Ÿæˆæ‰€æœ‰å›¾è¡¨å’ŒæŠ¥å‘Š

#### é€‰é¡¹Bï¼šè¿è¡ŒLP-IRFåˆ†æ
```bash
python src/analysis/lp_irf_analysis.py
```

#### é€‰é¡¹Cï¼šæµ‹è¯•äº‹ä»¶ç ”ç©¶åŠŸèƒ½ ğŸ†•
```bash
python test_event_study.py
```

### 4. æŸ¥çœ‹ç»“æœ

åˆ†æå®Œæˆåï¼Œç»“æœå°†ä¿å­˜åœ¨ï¼š
- **è¡¨æ ¼æ•°æ®**ï¼š`output/tables/`
- **å›¾è¡¨**ï¼š`output/figures/`
- **åˆ†ææŠ¥å‘Š**ï¼š`output/event_study_analysis_report.md` ğŸ†•

## äº‹ä»¶ç ”ç©¶æ–¹æ³•è¯¦è§£

### æ–¹æ³•è®ºæ¡†æ¶

1. **äº‹ä»¶è¯†åˆ«**
   - ä¿è¯é‡‘å¢åŠ äº‹ä»¶ï¼š`dlog_margin_rate > threshold`
   - ä¿è¯é‡‘å‡å°‘äº‹ä»¶ï¼š`dlog_margin_rate < -threshold`
   - è‡ªåŠ¨è¿‡æ»¤é‡å äº‹ä»¶ï¼ˆæœ€å°é—´éš”30å¤©ï¼‰

2. **äº‹ä»¶çª—å£è®¾å®š**
   - äº‹ä»¶çª—å£ï¼š[-10, +10] å¤©
   - ä¼°è®¡çª—å£ï¼š120å¤©ï¼ˆä¸äº‹ä»¶çª—å£é—´éš”5å¤©ï¼‰
   - æœ€å°ä¼°è®¡è§‚æµ‹ï¼š60ä¸ª

3. **æ­£å¸¸æ”¶ç›Šç‡æ¨¡å‹**
   - **å¸‚åœºæ¨¡å‹**ï¼ˆé»˜è®¤ï¼‰ï¼š`E(R_it) = Î±_i + Î²_i * R_mt`
   - **å‡å€¼è°ƒæ•´æ¨¡å‹**ï¼š`E(R_it) = Î¼_i`
   - **å¸‚åœºè°ƒæ•´æ¨¡å‹**ï¼š`E(R_it) = R_mt`

4. **å¼‚å¸¸æ”¶ç›Šç‡è®¡ç®—**
   - å¼‚å¸¸æ”¶ç›Šç‡ï¼š`AR_it = R_it - E(R_it)`
   - ç´¯ç§¯å¼‚å¸¸æ”¶ç›Šç‡ï¼š`CAR_i(t1,t2) = Î£ AR_it`
   - å¹³å‡å¼‚å¸¸æ”¶ç›Šç‡ï¼š`AAR_t = (1/N) * Î£ AR_it`

5. **ç»Ÿè®¡æ£€éªŒ**
   - tç»Ÿè®¡é‡æ£€éªŒ
   - 95%ç½®ä¿¡åŒºé—´
   - æ˜¾è‘—æ€§æ ‡è®°

### ä¸»è¦è¾“å‡ºæ–‡ä»¶

#### æ•°æ®è¡¨æ ¼ (`output/tables/`)
- `event_study_aar_increase.csv` - ä¿è¯é‡‘å¢åŠ äº‹ä»¶AARç»“æœ
- `event_study_aar_decrease.csv` - ä¿è¯é‡‘å‡å°‘äº‹ä»¶AARç»“æœ
- `event_study_events_*.csv` - è¯†åˆ«çš„äº‹ä»¶åˆ—è¡¨
- `event_study_car_*.csv` - è¯¦ç»†CARæ•°æ®
- `lp_irf_vs_event_study_correlation_*.csv` - ç›¸å…³æ€§åˆ†æç»“æœ

#### å›¾è¡¨æ–‡ä»¶ (`output/figures/`)
- `event_study_aar_*.png` - AARæ—¶é—´åºåˆ—å›¾
- `event_study_distribution_*.png` - äº‹ä»¶åˆ†å¸ƒå›¾
- `event_study_summary.png` - ç»“æœæ±‡æ€»å›¾
- `lp_irf_vs_event_study_*.png` - æ–¹æ³•æ¯”è¾ƒå›¾

### ç¨³å¥æ€§æ£€éªŒ

é¡¹ç›®å®ç°äº†å¤šç§ç¨³å¥æ€§æ£€éªŒï¼š

1. **æ›¿ä»£æ³¢åŠ¨ç‡æŒ‡æ ‡**ï¼šä½¿ç”¨Parkinsonæ³¢åŠ¨ç‡
2. **ä¸åŒäº‹ä»¶é˜ˆå€¼**ï¼šæ›´ä¸¥æ ¼çš„è¯†åˆ«æ ‡å‡†
3. **æ’é™¤æç«¯äº‹ä»¶**ï¼šç§»é™¤æœ€æç«¯1%çš„è°ƒæ•´
4. **å“ç§åˆ†ç»„åˆ†æ**ï¼šæŒ‰æœŸè´§å“ç§åˆ†åˆ«åˆ†æ

æ¯ç§ç¨³å¥æ€§æ£€éªŒéƒ½ä¼šç”Ÿæˆç›¸åº”çš„ç»“æœæ–‡ä»¶ï¼ˆå¸¦ç‰¹å®šåç¼€ï¼‰ã€‚

## æ¯”è¾ƒåˆ†æ

### LP-IRF vs äº‹ä»¶ç ”ç©¶

| ç»´åº¦ | LP-IRF | äº‹ä»¶ç ”ç©¶ |
|------|--------|----------|
| æ—¶é—´èŒƒå›´ | ä¸­æœŸ (0-10æœŸ) | çŸ­æœŸ (Â±10å¤©) |
| åŸºå‡†è®¾å®š | æ§åˆ¶å˜é‡ | å†å²æ­£å¸¸æ”¶ç›Šç‡ |
| å› æœè¯†åˆ« | å¼º | ä¸­ç­‰ |
| è®¡ç®—å¤æ‚åº¦ | é«˜ | ä¸­ç­‰ |
| è§£é‡Šç›´è§‚æ€§ | ä¸­ç­‰ | é«˜ |

### äº’è¡¥æ€§åˆ†æ

1. **éªŒè¯æ€§**ï¼šä¸¤ç§æ–¹æ³•ç»“æœä¸€è‡´æ€§å¢å¼ºç»“è®ºå¯ä¿¡åº¦
2. **æ—¶é—´ç»´åº¦**ï¼šçŸ­æœŸå’Œä¸­æœŸå½±å“çš„å®Œæ•´å›¾æ™¯
3. **ç¨³å¥æ€§**ï¼šä¸åŒæ–¹æ³•è®ºæ¡†æ¶ä¸‹çš„ä¸€è‡´å‘ç°

## é…ç½®å‚æ•°

ä¸»è¦å‚æ•°åœ¨ `src/config.py` ä¸­é…ç½®ï¼š

```python
# äº‹ä»¶ç ”ç©¶å‚æ•°
EVENT_STUDY_PRE_WINDOW = 10          # äº‹ä»¶å‰çª—å£
EVENT_STUDY_POST_WINDOW = 10         # äº‹ä»¶åçª—å£
EVENT_STUDY_ESTIMATION_WINDOW = 120  # ä¼°è®¡çª—å£é•¿åº¦
EVENT_STUDY_GAP_DAYS = 5             # çª—å£é—´éš”
EVENT_STUDY_MIN_ESTIMATION_OBS = 60  # æœ€å°ä¼°è®¡è§‚æµ‹æ•°
EVENT_STUDY_MIN_EVENT_GAP = 30       # äº‹ä»¶æœ€å°é—´éš”
EVENT_STUDY_NORMAL_RETURN_MODEL = "market_model"  # æ­£å¸¸æ”¶ç›Šç‡æ¨¡å‹
EVENT_STUDY_SIGNIFICANCE_LEVEL = 0.05  # æ˜¾è‘—æ€§æ°´å¹³
```

## æŠ€æœ¯ç‰¹ç‚¹

### æ•°æ®å¤„ç†
- è‡ªåŠ¨å¤„ç†ç¼ºå¤±å€¼å’Œå¼‚å¸¸å€¼
- æ”¯æŒä¸å¹³è¡¡é¢æ¿æ•°æ®
- çµæ´»çš„äº‹ä»¶ç­›é€‰æœºåˆ¶

### ç»Ÿè®¡æ–¹æ³•
- å¤šç§æ­£å¸¸æ”¶ç›Šç‡æ¨¡å‹
- æ ‡å‡†åŒ–å¼‚å¸¸æ”¶ç›Šç‡
- ç¨³å¥çš„ç»Ÿè®¡æ£€éªŒ

### å¯è§†åŒ–
- ä¸­æ–‡å­—ä½“æ”¯æŒ
- ä¸“ä¸šçš„å­¦æœ¯å›¾è¡¨é£æ ¼
- è‡ªåŠ¨åŒ–æ‰¹é‡ç”Ÿæˆ

### æ‰©å±•æ€§
- æ¨¡å—åŒ–è®¾è®¡
- æ”¯æŒä¸åŒç»“æœå˜é‡
- çµæ´»çš„å‚æ•°é…ç½®

## ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬ä½¿ç”¨

```python
from src.analysis.event_study_analysis import run_event_study_analysis_core
import pandas as pd

# åŠ è½½æ•°æ®
df = pd.read_parquet('data/processed/panel_data_features.parquet')

# è¿è¡Œäº‹ä»¶ç ”ç©¶
results = run_event_study_analysis_core(
    data=df,
    outcome_var='log_gk_volatility',
    output_table_dir='output/tables',
    threshold=1e-6
)
```

### è‡ªå®šä¹‰åˆ†æ

```python
from src.analysis.event_study_analysis import EventStudyAnalyzer

# åˆ›å»ºåˆ†æå™¨
analyzer = EventStudyAnalyzer(
    data=df,
    outcome_var='log_gk_volatility',
    event_var='dlog_margin_rate'
)

# æ‰§è¡Œåˆ†æ
results = analyzer.run_event_study(threshold=1e-6)
```

### å¯è§†åŒ–ç”Ÿæˆ

```python
from src.visualization.plot_event_study_results import generate_event_study_plots

generate_event_study_plots(
    results_dict=results,
    outcome_var='log_gk_volatility',
    output_dir='output/figures'
)
```

## æ³¨æ„äº‹é¡¹

1. **æ•°æ®è´¨é‡**ï¼šç¡®ä¿æ—¥æœŸåˆ—ä¸ºdatetimeæ ¼å¼ï¼Œä¿è¯é‡‘æ•°æ®æœ‰è¶³å¤Ÿå˜å¼‚
2. **å‚æ•°é€‰æ‹©**ï¼šæ ¹æ®å¸‚åœºç‰¹å¾è°ƒæ•´äº‹ä»¶çª—å£å’Œä¼°è®¡çª—å£é•¿åº¦
3. **ç»“æœè§£é‡Š**ï¼šäº‹ä»¶ç ”ç©¶ä¸ºæè¿°æ€§åˆ†æï¼Œéœ€ç»“åˆLP-IRFè¿›è¡Œå› æœæ¨æ–­
4. **è®¡ç®—èµ„æº**ï¼šå¤§æ•°æ®é›†å¯èƒ½éœ€è¦è¾ƒé•¿è®¡ç®—æ—¶é—´

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ— äº‹ä»¶è¯†åˆ«**ï¼šæ£€æŸ¥é˜ˆå€¼è®¾ç½®å’Œæ•°æ®è´¨é‡
2. **ä¼°è®¡çª—å£ä¸è¶³**ï¼šè°ƒæ•´`EVENT_STUDY_MIN_ESTIMATION_OBS`å‚æ•°
3. **å†…å­˜ä¸è¶³**ï¼šä½¿ç”¨æ•°æ®å­é›†æˆ–å¢åŠ ç³»ç»Ÿå†…å­˜
4. **å›¾è¡¨æ˜¾ç¤ºé—®é¢˜**ï¼šç¡®ä¿ä¸­æ–‡å­—ä½“æ­£ç¡®å®‰è£…

### è°ƒè¯•æ¨¡å¼

å¯ç”¨è¯¦ç»†æ—¥å¿—ï¼š
```python
import logging
logging.basicConfig(level=logging.DEBUG)
```

## è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ä»£ç å’Œå»ºè®®ï¼è¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. åˆ›å»º Pull Request

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚
